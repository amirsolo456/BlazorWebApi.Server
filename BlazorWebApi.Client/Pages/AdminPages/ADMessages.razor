@page "/AdminMessages"
@using BlazorWebApi.Client.Components
@using BlazorWebApi.Domain.Entities.Shared
@layout BlazorWebApi.Client.Shared.Admin.AdminLayout
@inject HttpClient _httpclient
<style>
    .navbar-custom {
        margin-top: 50px; /* فاصله 50 پیکسل از بالا */
        border: 1px solid #ccc; /* حاشیه برای Navbar */
        background-color: #ffffff !important;
        padding: 15px; /* Padding برای Navbar */
    }

    .custom-select {
        height: 35px; /* افزایش ارتفاع ComboBox */
        width: 200px; /* افزایش عرض ComboBox */
        font-size: 16px; /* افزایش اندازه فونت */
    }

    .radio-group {
        margin-top: 15px; /* فاصله از ComboBox */
        margin-top: 15px; /* فاصله از ComboBox */
        display: flex; /* استفاده از Flexbox برای قرار دادن رادیو باتن‌ها در یک ردیف */
        gap: 20px; /* فاصله بین رادیو باتن‌ها */

    }

    .form-check {
        display: flex; /* تنظیم رادیو باتن‌ها به صورت افقی */
        align-items: center; /* تراز کردن رادیو باتن و لیبل */
        margin-right: 20px;
    }

    .form-check-input {
        margin-top: 0; /* جلوگیری از حرکت دایره به سمت بالا */
        margin-right: 10px; /* فاصله بین دایره و متن */
    }

    .form-check-label {
        margin-bottom: 0; /* جلوگیری از ایجاد فاصله اضافی در پایین */
    }


</style>

<nav class="navbar navbar-expand-lg navbar-light bg-light navbar-custom" >
    <div class="container-fluid">
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <div class="ms-auto">
                <select class="form-select custom-select" @bind="selectedOption">
                    <option value="option1">پیام های مشتری</option>
                    <option value="option2">پیام های مالک </option>
                </select>
            </div>
            <div class="ms-auto">
                <div class="radio-group" style="margin-left:300px">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="options" id="option1" value="option1" checked>
                        <label class="form-check-label" style="margin-right:25px" for="option1">
                           خوانده نشده ها
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="options" id="option2" value="option2">
                        <label class="form-check-label" style="margin-right:25px" for="option2">
                           همه پیام ها
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="options" id="option3" value="option3">
                        <label class="form-check-label" style="margin-right:25px" for="option3">
                           پاسخ داده شده ها
                        </label>
                    </div>
                </div>
            </div>

        </div>
    </div>
</nav>

<div class="container">
    <a href="/ADCreateMessage">
        <button type="submit" class="btn btn-outline-secondary">
        </button>
    </a>
    <table class="table table-bordered table-striped" style="font-family:Tahoma ; font-size:14px">
        <thead>
            <tr>
                @foreach (TableHeaderName header in TableHeaderNames)
                {
                    <th colspan="@header.Colspan">
                        @header.Name
                    </th>
                }
            </tr>
        </thead>
        <tbody>
            @if (messageReplays != null)
            {
                @foreach (MessageReplays item in messageReplays)
                {
                    <tr>
                        <td colspan="@TableHeaderNames[0].Colspan">
                            @item.message.ID
                        </td>
                        <td colspan="@TableHeaderNames[1].Colspan">
                            @item.message
                        </td>
                        <td colspan="@TableHeaderNames[2].Colspan">
                            @item.message.SenderName
                        </td>
                        <td colspan="@TableHeaderNames[3].Colspan">
                            @item.message.SabtDate
                        </td>
                        <td colspan="@TableHeaderNames[4].Colspan">
                            @if(item.message.VillaID != null)
                                @item.message.VillaID
                        </td>
                        <td colspan="@TableHeaderNames[5].Colspan">
                            <a>
                                <button @onclick="() => ShowReplyForm(item.message.ID)">پاسخ</button>
                            </a>
                        </td>

                    </tr>
                    if (item.replays != null)
                    {
                        foreach (Messages replay in item.replays)
                        {
                            <tr>
                                <td colspan="@TableHeaderNames[0].Colspan">
                                    @replay.ID
                                </td>
                                <td colspan="@TableHeaderNames[1].Colspan">
                                    @replay.Message
                                </td>
                                <td colspan="@TableHeaderNames[2].Colspan">
                                    @replay.SenderName
                                </td>

                                <td colspan="@TableHeaderNames[3].Colspan">
                                    @replay.SabtDate
                                </td>
                                <td colspan="@TableHeaderNames[4].Colspan">
                                    @if (replay.VillaID != null)
                                        @replay.VillaID
                                </td>

                                <td colspan="@TableHeaderNames[5].Colspan">
                                </td>
                                </tr>
                        }
                    }

                    if (replyVisible)
                    {
                        <tr>
                            <div class="row">
                                <BlazorWebApi.Client.Shared.CreateMessage Type="2" IDRecieve="item.message.IDSend" IDRefMessage="item.message.ID" IDSend="AdminID" />

                            </div>
                        </tr>
                    }
                }
            }

        </tbody>
    </table>
</div>



@code {
    private string selectedOption = "option1"; // گزینه انتخاب شده
    private bool replyVisible = false; // وضعیت نمایش پارشیال
    private int selectedMessageId; // ID پیام انتخاب شده

    public IEnumerable<MessageReplays> messageReplays { get; set; }

    public int AdminID = 2;

    List<TableHeaderName> TableHeaderNames = new()
    {
        new TableHeaderName("کد",1),
        new TableHeaderName("پیام",2),
        new TableHeaderName("فرستنده",1),
        new TableHeaderName("تاریخ ثبت",1),
        new TableHeaderName("کد ویلا",1),
         new TableHeaderName(" ",1),
    };
}

@functions {
    protected override async Task OnInitializedAsync()
    {
        try
        {
            messageReplays = await _httpclient.GetFromJsonAsync<IEnumerable<MessageReplays>>("/api/Messages");
        }
        catch (Exception ex)
        {
            Console.WriteLine("خطا:" + ex.Message);
        }

        base.OnInitializedAsync();
    }

    private void ShowReplyForm(int messageId)
    {
        selectedMessageId = messageId;
        replyVisible = true; // نمایش پارشیال
    }

    private void HideReplyForm(bool closed)
    {
        replyVisible = false; // مخفی کردن پارشیال
    }

    private void GetMessageByType(int Type)
    {
        if (Type == 0)
        {

        }
        else if(Type == 1)
        {

        }
        else if(Type == 2)
        {
            
        }
    }
}
